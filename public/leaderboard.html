<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ramadan Digital Skills League 2026 ‚Äî Live Leaderboard</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700;900&family=Nunito:ital,wght@0,300;0,400;0,600;1,300&display=swap" rel="stylesheet">
<style>
  :root {
    --midnight: #06080f;
    --surface:  #0e1120;
    --panel:    #131929;
    --card:     #1a2035;
    --border:   #252f4a;
    --gold:     #d4a843;
    --gold-l:   #f0c96a;
    --gold-d:   #7a5e1e;
    --text:     #e8e4d9;
    --muted:    #7a849e;
    --muted2:   #3a4460;
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  html { scroll-behavior: smooth; }
  body {
    background: var(--midnight);
    color: var(--text);
    font-family: 'Nunito', sans-serif;
    font-weight: 300;
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* ‚îÄ‚îÄ BACKGROUND ‚îÄ‚îÄ */
  body::before {
    content: '';
    position: fixed; inset: 0; pointer-events: none; z-index: 0;
    background:
      radial-gradient(ellipse 80% 60% at 50% -20%, rgba(212,168,67,0.07) 0%, transparent 70%),
      radial-gradient(ellipse 60% 40% at 80% 80%, rgba(45,212,191,0.05) 0%, transparent 60%),
      radial-gradient(ellipse 50% 50% at 20% 70%, rgba(167,139,250,0.04) 0%, transparent 60%);
  }
  .stars { position:fixed; inset:0; pointer-events:none; z-index:0; overflow:hidden; }
  .star {
    position:absolute; background:white; border-radius:50%;
    animation: twinkle var(--dur,3s) ease-in-out infinite;
    animation-delay: var(--delay,0s); opacity:0;
  }
  @keyframes twinkle {
    0%,100%{opacity:0;transform:scale(0.5)}
    50%{opacity:var(--op,0.7);transform:scale(1)}
  }
  .geo-bg {
    position:fixed; inset:0; pointer-events:none; z-index:0; opacity:0.03;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='60' height='60'%3E%3Cpolygon points='30,2 58,18 58,42 30,58 2,42 2,18' fill='none' stroke='%23d4a843' stroke-width='0.5'/%3E%3Cpolygon points='30,12 48,22 48,38 30,48 12,38 12,22' fill='none' stroke='%23d4a843' stroke-width='0.5'/%3E%3C/svg%3E");
  }

  /* ‚îÄ‚îÄ ADMIN LINK ‚îÄ‚îÄ */
  .admin-link {
    position: fixed;
    top: 16px; right: 20px;
    z-index: 100;
    font-family: 'Nunito', sans-serif;
    font-size: 11px;
    font-weight: 700;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    padding: 7px 16px;
    border-radius: 100px;
    border: 1px solid var(--border);
    background: rgba(14,17,32,0.8);
    color: var(--muted);
    cursor: pointer;
    text-decoration: none;
    backdrop-filter: blur(8px);
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .admin-link:hover {
    border-color: var(--gold-d);
    color: var(--gold-l);
    background: rgba(212,168,67,0.08);
  }

  /* ‚îÄ‚îÄ WRAPPER ‚îÄ‚îÄ */
  .wrapper { position:relative; z-index:1; max-width:1400px; margin:0 auto; padding:0 24px 80px; }

  /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
  header { text-align:center; padding:60px 0 48px; }
  .crescent { font-size:52px; display:block; margin-bottom:16px; animation:float 4s ease-in-out infinite; }
  @keyframes float { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-8px)} }
  .league-sub {
    font-family:'Cinzel',serif; font-size:11px; letter-spacing:6px;
    color:var(--gold); text-transform:uppercase; margin-bottom:12px; opacity:0.8;
  }
  h1 { font-family:'Cinzel',serif; font-size:clamp(28px,5vw,54px); font-weight:900; line-height:1.1; letter-spacing:-1px; }
  h1 .accent { color:var(--gold); display:block; }
  .header-meta { margin-top:14px; font-size:13px; color:var(--muted); letter-spacing:1px; }
  .header-divider { width:160px; height:1px; background:linear-gradient(to right,transparent,var(--gold-d),transparent); margin:24px auto 0; }

  /* ‚îÄ‚îÄ LIVE BADGE ‚îÄ‚îÄ */
  .live-badge {
    display:inline-flex; align-items:center; gap:7px;
    background:rgba(212,168,67,0.1); border:1px solid rgba(212,168,67,0.3);
    border-radius:100px; padding:6px 14px; font-size:11px; font-weight:600;
    letter-spacing:2px; text-transform:uppercase; color:var(--gold-l); margin-bottom:20px;
  }
  .live-dot { width:7px;height:7px;border-radius:50%;background:var(--gold-l);animation:pulse 1.5s ease-in-out infinite; }
  @keyframes pulse { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:0.4;transform:scale(0.6)} }

  /* ‚îÄ‚îÄ REFRESH INFO ‚îÄ‚îÄ */
  .refresh-info {
    display:flex; align-items:center; gap:6px; justify-content:center;
    font-size:11px; color:var(--muted); margin-top:10px;
  }

  /* ‚îÄ‚îÄ STATS STRIP ‚îÄ‚îÄ */
  .stats-strip {
    display:flex; gap:16px; justify-content:center; flex-wrap:wrap;
    margin-bottom:48px;
  }
  .stat-pill {
    background:var(--card); border:1px solid var(--border); border-radius:100px;
    padding:10px 22px; display:flex; align-items:center; gap:10px;
  }
  .stat-pill-val { font-family:'Cinzel',serif; font-size:22px; font-weight:900; color:var(--gold-l); }
  .stat-pill-label { font-size:12px; color:var(--muted); }

  /* ‚îÄ‚îÄ SECTION TITLE ‚îÄ‚îÄ */
  .section-title {
    font-family:'Cinzel',serif; font-size:12px; letter-spacing:5px; text-transform:uppercase;
    color:var(--muted); margin-bottom:24px; display:flex; align-items:center; gap:12px;
  }
  .section-title::after { content:''; flex:1; height:1px; background:var(--border); }

  /* ‚îÄ‚îÄ PODIUM ‚îÄ‚îÄ */
  .podium-wrap { display:flex; align-items:flex-end; justify-content:center; gap:12px; padding:0 12px; margin-bottom:64px; }

  .podium-card {
    flex:1; max-width:320px; border-radius:16px; padding:28px 20px 20px;
    text-align:center; position:relative; overflow:hidden; transition:transform 0.3s;
  }
  .podium-card:hover { transform:translateY(-4px); }
  .podium-card.rank-1 {
    background:linear-gradient(145deg,#1d1a0a,#1a1508);
    border:1px solid rgba(212,168,67,0.4);
    padding-top:40px; transform:translateY(-16px);
  }
  .podium-card.rank-1:hover { transform:translateY(-20px); }
  .podium-card.rank-2 { background:linear-gradient(145deg,#101520,#0d1119); border:1px solid rgba(147,197,253,0.2); }
  .podium-card.rank-3 { background:linear-gradient(145deg,#12100e,#100e0c); border:1px solid rgba(180,140,100,0.2); }

  .rank-badge { position:absolute; top:12px; left:50%; transform:translateX(-50%); font-family:'Cinzel',serif; font-size:10px; letter-spacing:3px; font-weight:700; }
  .rank-1 .rank-badge { color:var(--gold-l); }
  .rank-2 .rank-badge { color:#93c5fd; }
  .rank-3 .rank-badge { color:#b08060; }

  .podium-avatar {
    border-radius:50%; margin:0 auto 12px; display:flex; align-items:center; justify-content:center;
    font-size:28px; font-family:'Cinzel',serif; font-weight:700; position:relative;
  }
  .podium-crown { position:absolute; top:-18px; left:50%; transform:translateX(-50%); font-size:24px; animation:float 3s ease-in-out infinite; }

  .podium-name { font-family:'Cinzel',serif; font-size:16px; font-weight:700; color:var(--text); margin-bottom:4px; }
  .podium-dept { font-size:11px; letter-spacing:1.5px; color:var(--muted); text-transform:uppercase; margin-bottom:14px; }
  .podium-score { font-family:'Cinzel',serif; font-size:36px; font-weight:900; line-height:1; margin-bottom:2px; }
  .rank-1 .podium-score { color:var(--gold-l); }
  .rank-2 .podium-score { color:#93c5fd; }
  .rank-3 .podium-score { color:#c8a87a; }
  .podium-pts-label { font-size:10px; letter-spacing:2px; text-transform:uppercase; color:var(--muted); margin-bottom:14px; }

  .podium-cats { display:flex; flex-wrap:wrap; gap:5px; justify-content:center; }
  .cat-chip { font-size:9px; letter-spacing:1px; text-transform:uppercase; padding:3px 8px; border-radius:100px; font-weight:600; }

  /* ‚îÄ‚îÄ CAT GRID ‚îÄ‚îÄ */
  .cat-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(320px,1fr)); gap:20px; margin-bottom:64px; }

  .cat-card {
    background:var(--card); border-radius:16px; overflow:hidden; border:1px solid var(--border);
    transition:border-color 0.3s, transform 0.3s, box-shadow 0.3s;
  }
  .cat-card:hover { transform:translateY(-3px); box-shadow:0 12px 40px rgba(0,0,0,0.4); }

  .cat-header { padding:20px 22px 16px; border-bottom:1px solid var(--border); position:relative; overflow:hidden; }
  .cat-header::before { content:''; position:absolute; inset:0; background:var(--cat-grad); opacity:0.08; }

  .cat-label { font-size:9px; letter-spacing:3px; text-transform:uppercase; color:var(--muted); margin-bottom:5px; font-weight:600; }
  .cat-title { font-family:'Cinzel',serif; font-size:17px; font-weight:700; color:var(--text); display:flex; align-items:center; gap:10px; }
  .cat-emoji { font-size:22px; }
  .cat-weeks { margin-top:8px; font-size:11px; color:var(--muted); }

  .cat-leader-badge {
    position:absolute; top:16px; right:16px;
    font-size:9px; letter-spacing:2px; text-transform:uppercase;
    padding:4px 10px; border-radius:100px; font-weight:700;
    background:rgba(212,168,67,0.12); border:1px solid rgba(212,168,67,0.3); color:var(--gold-l);
    white-space:nowrap; max-width:120px; overflow:hidden; text-overflow:ellipsis;
  }

  .cat-body { padding:16px 22px 20px; }

  .lb-row {
    display:flex; align-items:center; gap:14px; padding:10px 0;
    border-bottom:1px solid rgba(42,53,85,0.5); transition:all 0.2s; border-radius:6px;
  }
  .lb-row:last-child { border-bottom:none; }
  .lb-row:hover { background:rgba(255,255,255,0.02); padding-left:6px; }

  .lb-rank { font-family:'Cinzel',serif; font-size:14px; font-weight:700; width:24px; text-align:center; flex-shrink:0; }
  .lb-rank.r1 { color:var(--gold); }
  .lb-rank.r2 { color:#93c5fd; }
  .lb-rank.r3 { color:#c8a87a; }
  .lb-rank.rn { color:var(--muted); }

  .lb-avatar { width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:13px;font-family:'Cinzel',serif;font-weight:700;color:#fff;flex-shrink:0; }
  .lb-info { flex:1; min-width:0; }
  .lb-name { font-size:14px; font-weight:600; color:var(--text); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
  .lb-detail { font-size:11px; color:var(--muted); margin-top:1px; }
  .lb-bar-wrap { width:100%; height:3px; background:rgba(255,255,255,0.05); border-radius:2px; margin-top:5px; overflow:hidden; }
  .lb-bar { height:100%; border-radius:2px; }

  .lb-score-wrap { text-align:right; flex-shrink:0; }
  .lb-score { font-family:'Cinzel',serif; font-size:20px; font-weight:700; line-height:1; }
  .lb-pts { font-size:9px; letter-spacing:1px; text-transform:uppercase; color:var(--muted); }

  /* Category colours */
  .cat-ace1 .cat-header { --cat-grad:linear-gradient(to right,#3b82f6,#06b6d4); }
  .cat-ace1 .cat-title  { color:#93c5fd; }
  .cat-ace1 .lb-bar     { background:linear-gradient(to right,#3b82f6,#06b6d4); }
  .cat-ace1 .lb-score   { color:#93c5fd; }
  .cat-ace1:hover       { border-color:rgba(59,130,246,0.4); box-shadow:0 12px 40px rgba(59,130,246,0.1); }

  .cat-ace2 .cat-header { --cat-grad:linear-gradient(to right,#06b6d4,#2dd4bf); }
  .cat-ace2 .cat-title  { color:#67e8f9; }
  .cat-ace2 .lb-bar     { background:linear-gradient(to right,#06b6d4,#2dd4bf); }
  .cat-ace2 .lb-score   { color:#67e8f9; }
  .cat-ace2:hover       { border-color:rgba(6,182,212,0.4); box-shadow:0 12px 40px rgba(6,182,212,0.1); }

  .cat-arena1 .cat-header { --cat-grad:linear-gradient(to right,#ec4899,#a855f7); }
  .cat-arena1 .cat-title  { color:#f9a8d4; }
  .cat-arena1 .lb-bar     { background:linear-gradient(to right,#ec4899,#a855f7); }
  .cat-arena1 .lb-score   { color:#f9a8d4; }
  .cat-arena1:hover       { border-color:rgba(236,72,153,0.4); box-shadow:0 12px 40px rgba(236,72,153,0.1); }

  .cat-arena2 .cat-header { --cat-grad:linear-gradient(to right,#f97316,#eab308); }
  .cat-arena2 .cat-title  { color:#fdba74; }
  .cat-arena2 .lb-bar     { background:linear-gradient(to right,#f97316,#eab308); }
  .cat-arena2 .lb-score   { color:#fdba74; }
  .cat-arena2:hover       { border-color:rgba(249,115,22,0.4); box-shadow:0 12px 40px rgba(249,115,22,0.1); }

  /* ‚îÄ‚îÄ LOADING / EMPTY ‚îÄ‚îÄ */
  .loading-wrap { display:flex; flex-direction:column; align-items:center; padding:60px 0; gap:16px; }
  .spinner { width:40px;height:40px;border:3px solid var(--border);border-top-color:var(--gold);border-radius:50%;animation:spin 0.8s linear infinite; }
  @keyframes spin { to{transform:rotate(360deg)} }
  .loading-text { color:var(--muted); font-size:14px; }
  .empty-state { text-align:center; padding:48px 20px; color:var(--muted); }
  .empty-icon-lg { font-size:48px; margin-bottom:12px; }

  /* ‚îÄ‚îÄ FILTER ‚îÄ‚îÄ */
  .controls { display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin-bottom:40px; }
  .filter-btn {
    font-family:'Nunito',sans-serif; font-size:12px; font-weight:600; letter-spacing:1.5px;
    text-transform:uppercase; padding:8px 20px; border-radius:100px; border:1px solid var(--border);
    background:transparent; color:var(--muted); cursor:pointer; transition:all 0.2s;
  }
  .filter-btn:hover,.filter-btn.active { border-color:var(--gold-d); background:rgba(212,168,67,0.08); color:var(--gold-l); }

  /* ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ */
  footer { text-align:center; padding:32px 0; border-top:1px solid var(--border); font-size:12px; color:var(--muted); letter-spacing:1px; }
  footer strong { color:var(--gold); }

  /* ‚îÄ‚îÄ ANIMATIONS ‚îÄ‚îÄ */
  @keyframes fadeInUp { from{opacity:0;transform:translateY(20px)} to{opacity:1;transform:translateY(0)} }
  .fade-in { animation:fadeInUp 0.6s ease forwards; opacity:0; }
  .d1{animation-delay:0.1s} .d2{animation-delay:0.2s} .d3{animation-delay:0.3s}

  /* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
  @media(max-width:768px){
    .podium-wrap { flex-direction:column; align-items:center; }
    .podium-card { max-width:100%; width:100%; }
    .podium-card.rank-1 { transform:none; order:-1; }
    .podium-card.rank-1:hover { transform:translateY(-4px); }
    .stats-strip { flex-direction:column; align-items:center; }
  }

  /* ‚îÄ‚îÄ NO-DATA PLACEHOLDER rows in cat cards ‚îÄ‚îÄ */
  .no-comp-msg { padding:24px 0; text-align:center; color:var(--muted); font-size:13px; }

  /* ‚îÄ‚îÄ AUTO REFRESH COUNTDOWN ‚îÄ‚îÄ */
  #countdown { color:var(--gold); font-weight:600; }
</style>
</head>
<body>

<div class="stars" id="stars"></div>
<div class="geo-bg"></div>

<!-- Admin link -->
<a class="admin-link" href="/index.html">‚öôÔ∏è <span>Admin</span></a>

<div class="wrapper">

  <!-- HEADER -->
  <header class="fade-in">
    <div class="live-badge"><div class="live-dot"></div>Live Standings</div>
    <div class="league-sub">ACE &amp; ARENA Qatar ‚Äî Ramadan 2026</div>
    <h1>Ramadan Digital<br><span class="accent">Skills League</span></h1>
    <div class="header-meta">4 Categories &nbsp;¬∑&nbsp; 16 Competitions &nbsp;¬∑&nbsp; 1 Grand Sultan</div>
    <div class="refresh-info">
      Auto-refreshes every <span id="countdown">30</span>s &nbsp;¬∑&nbsp;
      Last updated: <strong id="last-time" style="color:var(--text);margin-left:4px">‚Äî</strong>
    </div>
    <div class="header-divider"></div>
  </header>

  <!-- LOADING -->
  <div id="loading-state" class="loading-wrap fade-in d1">
    <div class="spinner"></div>
    <div class="loading-text">Fetching live standings‚Ä¶</div>
  </div>

  <!-- MAIN CONTENT (hidden until data loads) -->
  <div id="main-content" style="display:none">

    <!-- STATS STRIP -->
    <div class="stats-strip fade-in d1" id="stats-strip">
      <div class="stat-pill"><div class="stat-pill-val" id="stat-students">‚Äî</div><div class="stat-pill-label">Students</div></div>
      <div class="stat-pill"><div class="stat-pill-val" id="stat-comps">‚Äî</div><div class="stat-pill-label">Competitions</div></div>
      <div class="stat-pill"><div class="stat-pill-val" id="stat-scores">‚Äî</div><div class="stat-pill-label">Scores Recorded</div></div>
      <div class="stat-pill"><div class="stat-pill-val" id="stat-days">‚Äî</div><div class="stat-pill-label">Days Left</div></div>
    </div>

    <!-- FILTER CONTROLS -->
    <div class="controls fade-in d1">
      <button class="filter-btn active" onclick="filterCats('all',this)">üåô All</button>
      <button class="filter-btn" onclick="filterCats('ace',this)">üíª ACE</button>
      <button class="filter-btn" onclick="filterCats('arena',this)">üé® ARENA</button>
    </div>

    <!-- OVERALL PODIUM -->
    <section id="overall-section" class="fade-in d2">
      <div class="section-title">üèÜ Overall Standings ‚Äî Grand Sultan Race</div>
      <div class="podium-wrap" id="podium"></div>
    </section>

    <!-- CATEGORY CARDS -->
    <section class="fade-in d3">
      <div class="section-title">‚öîÔ∏è Category Leaderboards</div>
      <div class="cat-grid" id="cat-grid"></div>
    </section>

  </div><!-- /main-content -->

</div><!-- /wrapper -->

<footer>
  <strong>Ramadan Digital Skills League 2026</strong><br>
  M.H. Al Mana Education &amp; Training Services &nbsp;¬∑&nbsp; ACE &amp; ARENA Qatar &nbsp;¬∑&nbsp; Doha, Qatar
</footer>

<script>
// ‚îÄ‚îÄ STARS ‚îÄ‚îÄ
(function(){
  const c=document.getElementById('stars');
  for(let i=0;i<120;i++){
    const s=document.createElement('div'); s.className='star';
    const sz=Math.random()*2+0.5;
    s.style.cssText=`width:${sz}px;height:${sz}px;top:${Math.random()*100}%;left:${Math.random()*100}%;--dur:${2+Math.random()*4}s;--delay:${Math.random()*6}s;--op:${0.3+Math.random()*0.7}`;
    c.appendChild(s);
  }
})();

// ‚îÄ‚îÄ CONSTANTS ‚îÄ‚îÄ
const CATEGORIES = [
  { id:'ace1',   cls:'cat-ace1',   emoji:'üñ•Ô∏è', name:'Ramadan Code Quest',      dept:'ACE',   weeks:'Weeks 1 & 2  ¬∑  Feb 18‚Äì19' },
  { id:'ace2',   cls:'cat-ace2',   emoji:'‚ö°',  name:'Fast-Tech Firdaus',         dept:'ACE',   weeks:'Weeks 3 & 4  ¬∑  Mar 4‚Äì5'  },
  { id:'arena1', cls:'cat-arena1', emoji:'üé®', name:'Crescent Creative Studio',  dept:'ARENA', weeks:'Weeks 1 & 2  ¬∑  Feb 18‚Äì19' },
  { id:'arena2', cls:'cat-arena2', emoji:'üåü', name:'Digital Suhoor Designers',  dept:'ARENA', weeks:'Weeks 3 & 4  ¬∑  Mar 4‚Äì5'  },
];

const COLORS = ['#3b82f6','#ec4899','#10b981','#f97316','#a855f7','#06b6d4','#eab308','#ef4444','#14b8a6','#f43f5e','#84cc16','#8b5cf6'];
function colorFor(name){
  let h=0; for(let c of name) h=(h*31+c.charCodeAt(0))&0xfffffff;
  return COLORS[h%COLORS.length];
}
function initials(name){ return name.split(' ').slice(0,2).map(w=>w[0]||'').join('').toUpperCase(); }

let currentFilter = 'all';

// ‚îÄ‚îÄ FETCH & RENDER ‚îÄ‚îÄ
async function fetchAndRender() {
  try {
    const [lb, counts] = await Promise.all([
      fetch('/api/leaderboard').then(r=>r.json()),
      fetch('/api/scores').then(r=>r.json()),
    ]);
    const [students, comps] = await Promise.all([
      fetch('/api/students').then(r=>r.json()),
      fetch('/api/competitions').then(r=>r.json()),
    ]);

    document.getElementById('loading-state').style.display = 'none';
    document.getElementById('main-content').style.display  = 'block';

    // Stats
    document.getElementById('stat-students').textContent = students.length;
    document.getElementById('stat-comps').textContent    = comps.length;
    document.getElementById('stat-scores').textContent   = counts.length;
    const days = Math.max(0, Math.ceil((new Date('2026-03-18') - Date.now())/(86400000)));
    document.getElementById('stat-days').textContent = days;
    document.getElementById('last-time').textContent = new Date().toLocaleTimeString('en-GB',{hour:'2-digit',minute:'2-digit',second:'2-digit'});

    renderPodium(lb.overall);
    renderCats(lb.catLeaders, currentFilter);

  } catch(e) {
    document.getElementById('loading-state').innerHTML = `
      <div class="empty-state">
        <div class="empty-icon-lg">‚ö†Ô∏è</div>
        <div style="color:#fca5a5;font-size:14px">Could not load data ‚Äî retrying‚Ä¶</div>
      </div>`;
  }
}

// ‚îÄ‚îÄ PODIUM ‚îÄ‚îÄ
function renderPodium(overall) {
  const podium = document.getElementById('podium');
  if(!overall || !overall.length) {
    podium.innerHTML = `<div class="empty-state" style="width:100%"><div class="empty-icon-lg">üèÜ</div><div>No scores recorded yet ‚Äî check back after the first competition!</div></div>`;
    return;
  }

  const top = overall.slice(0,3);
  // Visual order: 2nd ¬∑ 1st ¬∑ 3rd
  const order = [top[1], top[0], top[2]];
  const meta  = [
    { cls:'rank-2', label:'2nd Place',   scoreColor:'#93c5fd',       avatarGrad:'#1e3a5f,#3b82f6', sz:72,  crown:false },
    { cls:'rank-1', label:'1st Place ‚ú¶', scoreColor:'var(--gold-l)', avatarGrad:'#a07520,#d4a843', sz:88,  crown:true  },
    { cls:'rank-3', label:'3rd Place',   scoreColor:'#c8a87a',       avatarGrad:'#4a3010,#b08060', sz:72,  crown:false },
  ];

  podium.innerHTML = '';
  order.forEach((row, i) => {
    if(!row) return;
    const m = meta[i];
    const catChips = CATEGORIES
      .filter(c => row.cats[c.id] != null)
      .map(c => {
        const ccs = { ace1:'background:rgba(59,130,246,.15);color:#93c5fd;border:1px solid rgba(59,130,246,.3)',
                      ace2:'background:rgba(6,182,212,.15);color:#67e8f9;border:1px solid rgba(6,182,212,.3)',
                      arena1:'background:rgba(236,72,153,.15);color:#f9a8d4;border:1px solid rgba(236,72,153,.3)',
                      arena2:'background:rgba(249,115,22,.15);color:#fdba74;border:1px solid rgba(249,115,22,.3)' };
        return `<span class="cat-chip" style="${ccs[c.id]}">${c.emoji} ${c.name.split(' ')[0]}</span>`;
      }).join('');

    const card = document.createElement('div');
    card.className = `podium-card ${m.cls}`;
    card.innerHTML = `
      <div class="rank-badge">${m.label}</div>
      <div class="podium-avatar" style="background:linear-gradient(135deg,${m.avatarGrad});width:${m.sz}px;height:${m.sz}px;font-size:${m.sz===88?30:22}px${m.sz===88?';box-shadow:0 0 30px rgba(212,168,67,0.35)':''}">
        ${m.crown ? '<div class="podium-crown">üëë</div>' : ''}
        ${initials(row.student.name)}
      </div>
      <div class="podium-name">${row.student.name}</div>
      <div class="podium-dept">${row.student.dept} Programme</div>
      <div class="podium-score" style="color:${m.scoreColor}">${row.total}</div>
      <div class="podium-pts-label">Total Points</div>
      <div class="podium-cats">${catChips}</div>`;
    podium.appendChild(card);
  });
}

// ‚îÄ‚îÄ CATEGORY CARDS ‚îÄ‚îÄ
function renderCats(catLeaders, filter) {
  const grid = document.getElementById('cat-grid');
  grid.innerHTML = '';

  CATEGORIES
    .filter(c => filter==='all' || (filter==='ace'&&c.dept==='ACE') || (filter==='arena'&&c.dept==='ARENA'))
    .forEach(cat => {
      const leaders = catLeaders[cat.id] || [];
      const maxPts  = leaders.length ? leaders[0].points : 100;

      const rowsHtml = leaders.slice(0,5).map((s, i) => {
        const rankCls  = ['r1','r2','r3','rn','rn'][i];
        const rankIcon = ['ü•á','ü•à','ü•â','4','5'][i];
        const barPct   = Math.round((s.points / maxPts) * 100);
        const c        = colorFor(s.name);
        return `<div class="lb-row">
          <div class="lb-rank ${rankCls}">${rankIcon}</div>
          <div class="lb-avatar" style="background:linear-gradient(135deg,${c}99,${c})">${initials(s.name)}</div>
          <div class="lb-info">
            <div class="lb-name">${s.name}</div>
            <div class="lb-detail">${s.dept} Programme</div>
            <div class="lb-bar-wrap"><div class="lb-bar" style="width:${barPct}%"></div></div>
          </div>
          <div class="lb-score-wrap">
            <div class="lb-score">${s.points}</div>
            <div class="lb-pts">pts</div>
          </div>
        </div>`;
      }).join('');

      const emptyMsg = leaders.length === 0
        ? `<div class="no-comp-msg">‚è≥ No scores recorded yet</div>` : '';

      const card = document.createElement('div');
      card.className = `cat-card ${cat.cls}`;
      card.innerHTML = `
        <div class="cat-header">
          <div class="cat-label">${cat.dept} Category</div>
          <div class="cat-title"><span class="cat-emoji">${cat.emoji}</span>${cat.name}</div>
          <div class="cat-weeks">üìÖ ${cat.weeks}</div>
          ${leaders.length ? `<div class="cat-leader-badge">üèÜ ${leaders[0].name.split(' ')[0]}</div>` : ''}
        </div>
        <div class="cat-body">${rowsHtml}${emptyMsg}</div>`;
      grid.appendChild(card);
    });
}

// ‚îÄ‚îÄ FILTER ‚îÄ‚îÄ
function filterCats(filter, btn) {
  currentFilter = filter;
  document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  // Re-render cats with current cached data (no new fetch needed)
  fetchAndRender();
}

// ‚îÄ‚îÄ AUTO REFRESH COUNTDOWN ‚îÄ‚îÄ
let countdown = 30;
setInterval(() => {
  countdown--;
  document.getElementById('countdown').textContent = countdown;
  if(countdown <= 0) { countdown = 30; fetchAndRender(); }
}, 1000);

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ
fetchAndRender();
</script>
</body>
</html>
